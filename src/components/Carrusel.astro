---
// Carrusel.astro
const { images } = Astro.props as { images: string[] };

import Izquierda from '../icons/Izquierda.astro';
import Derecha from '../icons/Derecha.astro';
---

<div id="carrusel-container" class="relative w-full max-w-2xl h-[450px] mx-auto overflow-hidden transition-all duration-500">
  {images.map((img, index) => (
    <img
      src={img}
      alt={`Imagen ${index + 1}`}
      class="carrusel-img absolute inset-0 h-full w-auto max-w-full rounded-lg object-contain mx-auto transition-opacity duration-700 ease-in-out"
      style={`opacity: ${index === 0 ? '1' : '0'}`}
      loading="lazy"
    />
  ))}

  <!-- Botones -->
  <button id="prev" class="absolute cursor-pointer left-2 top-1/2 -translate-y-1/2 bg-page-200/70 rounded-full z-10"><Izquierda class="m-2" /></button>
  <button id="next" class="absolute cursor-pointer right-2 top-1/2 -translate-y-1/2 bg-page-200/70 rounded-full z-10"><Derecha class="m-2"/></button>
</div>

<script type="module">
  const images = document.querySelectorAll('.carrusel-img');
  const container = document.getElementById('carrusel-container');
  const prevBtn = document.getElementById('prev');
  const nextBtn = document.getElementById('next');
  let current = 0;
  let autorollActivo = true;
  let autorollID = null;

  function actualizarCarrusel() {
    images.forEach((img, i) => {
      img.style.opacity = i === current ? '1' : '0';
    });
  }

  function detenerAutoroll() {
    if (autorollActivo) {
      clearInterval(autorollID);
      autorollActivo = false;
    }
  }

  nextBtn.addEventListener('click', () => {
    detenerAutoroll();
    current = (current + 1) % images.length;
    actualizarCarrusel();
  });

  prevBtn.addEventListener('click', () => {
    detenerAutoroll();
    current = (current - 1 + images.length) % images.length;
    actualizarCarrusel();
  });

  autorollID = setInterval(() => {
    if (autorollActivo) {
      current = (current + 1) % images.length;
      actualizarCarrusel();
    }
  }, 4000);

  // Inicializaci√≥n
  window.addEventListener('load', ajustarAlturaFija);
  window.addEventListener('resize', ajustarAlturaFija);
</script>