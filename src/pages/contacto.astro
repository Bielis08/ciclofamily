---
import MiniHeader from "../components/MiniHeader.astro";
import Layout from "../layouts/Layout.astro";
---

<Layout title="Ciclo Family | Todas las rutas en bicicleta por Catalunya">
    <title>Ciclo Family | Contacta con nosotros</title>
    <MiniHeader />
    <main class="max-w-7xl mx-auto">
        <h2 class="text-4xl text-center mt-52 font-bold text-lime-900">Contacta con nosotros</h2>
        <p class="text-pretty w-96 text-center mx-auto my-4 font-medium text-gray-800">¿Tienes alguna pregunta sobre nuestras rutas? ¿Quieres sugerir una nueva ruta?</p>
        <section class="grid grid-cols-2 gap-40 mt-20">
            <article class="py-8 px-7 bg-page-200 rounded-lg">
                <h2 class="text-2xl font-semibold text-lime-950">Envianos un mensaje</h2>
                <p class="text-pretty font-medium text-sm my-2">Completa el formulario y te responderemos lo antes posible.</p>
                <form class="grid gap-1 mt-6 text-lime-900 font-medium" action="https://formspree.io/f/mdkdzrnn" method="post">
                    <div class="flex gap-12">
                        <div>
                            <label for="nombre">Nombre: *</label>
                            <input class="border-2 border-green-600/70 rounded-lg px-2 py-1 w-full" placeholder="Ej: Jaume" type="text" id="nombre" name="Nombre" required>
                        </div>
                        <div>
                            <label for="apellidos">Apellidos: *</label>
                            <input class="border-2 border-green-600/70 rounded-lg px-2 py-1 w-full" placeholder="Ej: García" type="text" id="apellidos" name="Apellidos" required>
                        </div>
                    </div>
                    <label for="email">Email: *</label>
                    <input class="border-2 border-green-600/70 rounded-lg px-2 py-1" placeholder="Ej: jaumegarcia@ciclofamily.com" type="email" id="email" name="Email" required>
                    <label for="tel">Teléfono: <span class="italic">(opcional)</span></label>
                    <input class="border-2 border-green-600/70 rounded-lg px-2 py-1" placeholder="Ej: 654123987" type="tel" id="telefono" name="Telefono">
                    <label for="asunto">Asunto: *</label>
                    <select class="border-2 border-green-600/70 rounded-lg p-2">
                        <option value="Selecciona">Selecciona un asunto</option>
                        <option value="Consulta">Consulta sobre una ruta</option>
                        <option value="Sugerir">Sugerir nueva ruta</option>
                        <option value="Reportar">Reportar problema en una ruta</option>
                        <option value="Problema">Problema en al web</option>
                        <option value="Otro">Otro</option>
                    </select>
                    <label for="mensaje">Adjuntar imagenes o rutas: *</label>
                    <input type="file" id="Adjuntos" name="Adjuntos" multiple>
                    <div class="preview text-sm mt-4 space-y-3">
                        <p></p>
                    </div>
                    <label for="mensaje">Mensaje: *</label>
                    <textarea class="border-2 border-green-600/70 rounded-lg px-2 py-1 max-h-40 min-h-12" id="message" name="Mensaje" autocorrect="on" spellcheck="true" required></textarea>
                    <input class="cursor-pointer mt-8 w-48 rounded-lg py-2 mx-auto text-xl bg-green-500/70 hover:bg-green-800 hover:text-white transition" type="submit" value="Enviar Mensaje">
                </form>
            </article>
            <section class="grid gap-20">
                <article class="py-8 px-7 bg-page-200 rounded-lg">
                    <h2 class="text-2xl font-semibold text-lime-950">Información de contacto</h2>
                </article>
                <article class="py-8 px-7 bg-page-200 rounded-lg">
                    <h2 class="text-2xl font-semibold text-lime-950">Síguenos en Wikiloc</h2>
                </article>
            </section>
            
        </section>
    </main>
</Layout>

<script is:inline>
  const input = document.querySelector("#image_uploads");
  const preview = document.querySelector(".preview");
  let storedFiles = [];

  input.addEventListener("change", updateImageDisplay);

  function updateImageDisplay() {
    const curFiles = Array.from(input.files);

    for (const file of curFiles) {
      if (!storedFiles.some(f => f.name === file.name && f.size === file.size)) {
        storedFiles.push(file);
      }
    }

    renderPreview();
    input.value = "";
  }

  function renderPreview() {
    preview.innerHTML = "";

    if (storedFiles.length === 0) {
      const para = document.createElement("p");
      para.textContent = "No hay archivos seleccionados actualmente para subir";
      preview.appendChild(para);
      return;
    }

    const list = document.createElement("ol");
    list.className = "flex flex-wrap gap-4";
    preview.appendChild(list);

    storedFiles.forEach((file, index) => {
      const listItem = document.createElement("li");
      listItem.className = "relative bg-white p-2 rounded shadow w-fit text-center text-xs";

      // ❌ Botón de eliminar
      const removeBtn = document.createElement("button");
      removeBtn.textContent = "✖";
      removeBtn.className = "absolute top-1 right-1 text-red-600 text-sm hover:text-red-800";
      removeBtn.setAttribute("aria-label", `Eliminar archivo ${file.name}`);
      removeBtn.addEventListener("click", () => {
        storedFiles.splice(index, 1);
        renderPreview();
      });
      listItem.appendChild(removeBtn);

      if (validFileType(file)) {
        if (file.type.startsWith("image/")) {
          const image = document.createElement("img");
          image.src = URL.createObjectURL(file);
          image.alt = file.name;
          image.title = file.name;
          image.className = "max-w-[80px] mt-2 rounded shadow mx-auto";
          listItem.appendChild(image);
        }

        const name = document.createElement("p");
        name.textContent = file.name;
        name.className = "mt-2 break-all";

        const size = document.createElement("p");
        size.textContent = returnFileSize(file.size);
        size.className = "text-gray-500";

        listItem.appendChild(name);
        listItem.appendChild(size);
      } else {
        const para = document.createElement("p");
        para.textContent = `Nombre del archivo ${file.name}: tipo no válido.`;
        listItem.appendChild(para);
      }

      list.appendChild(listItem);
    });
  }

  const fileTypes = [
    "image/apng", "image/bmp", "image/gif", "image/jpeg",
    "image/pjpeg", "image/png", "image/svg+xml", "image/tiff",
    "image/webp", "image/x-icon", "application/gpx+xml", ".gpx"
  ];

  function validFileType(file) {
    return fileTypes.includes(file.type) || file.name.endsWith(".gpx");
  }

  function returnFileSize(number) {
    if (number < 1e3) return `${number} bytes`;
    if (number < 1e6) return `${(number / 1e3).toFixed(1)} KB`;
    return `${(number / 1e6).toFixed(1)} MB`;
  }
</script>
